{% extends "base.html" %}
{% load static %}

{% block title %}–õ–µ–Ω—Ç–∞{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/feed.css' %}">
<link rel="stylesheet" href="{% static 'css/comments.css' %}">
<script src="{% static 'js/like.js' %}"></script>
<script src="{% static 'js/comments.js' %}"></script>
{% endblock %}

{% block main_content %}
<div class="feed-container">
    <h1 class="feed-title">–õ–µ–Ω—Ç–∞</h1>
    <div class="posts-grid">
        {% for post in posts %}
        <div class="post-card">
            <div class="post">
                <div class="post-header">
                    <img src="{{ post.user.profile_picture.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="post-avatar">
                    <div>
                        <p>{{ post.user.first_name }} {{ post.user.last_name }}</p>
                        <span class="post-date">{{ post.created_at|date:"d M Y H:i" }}</span>
                    </div>
                </div>
                <p>{{ post.content }}</p>
                {% if post.image %}
                    <img src="{{ post.image.url }}" class="post-image" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                {% endif %}
                <div class="post-actions">
                    <button class="like-btn" data-post-id="{{ post.id }}">
                        {% if post.is_liked %}
                            ‚ù§Ô∏è {{ post.likes.count }}
                        {% else %}
                            ü§ç {{ post.likes.count }}
                        {% endif %}
                    </button>
                    <button class="toggle-comments-btn">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ post.comments.count }})</button>
                </div>
            </div>
        
            <div class="comments-container">
                <div class="post-comments">
                    <div class="comments-section">
                        {% for comment in post.top_comments %}
                            <div class="comment">
                                <div class="comment-header">
                                    <img src="{{ comment.user.profile_picture.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="comment-avatar">
                                    <span class="comment-author">{{ comment.user.first_name }} {{ comment.user.last_name }}</span>
                                    <span class="comment-date">{{ comment.created_at|date:"d M Y H:i" }}</span>
                                </div>
                                <p class="comment-content">{{ comment.content }}</p>
                                <a href="#" class="reply-btn" data-comment-id="{{ comment.id }}">–û—Ç–≤–µ—Ç–∏—Ç—å</a>
                                <div class="reply-form" style="display: none;">
                                    <textarea placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..." required></textarea>
                                    <button class="btn-submit-reply" data-post-id="{{ post.id }}" data-parent-id="{{ comment.id }}">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                                </div>
                                {% if comment.branch_replies %}
                                    <div class="nested-replies">
                                        {% for reply in comment.branch_replies %}
                                            <div class="comment reply">
                                                <div class="comment-header">
                                                    <img src="{{ reply.user.profile_picture.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="comment-avatar">
                                                    <span class="comment-author">{{ reply.user.first_name }} {{ reply.user.last_name }}</span>
                                                    <span class="comment-date">{{ reply.created_at|date:"d M Y H:i" }}</span>
                                                </div>
                                                <p class="comment-content">{{ reply.content }}</p>
                                                <a href="#" class="reply-btn" data-comment-id="{{ reply.id }}">–û—Ç–≤–µ—Ç–∏—Ç—å</a>
                                                <div class="reply-form" style="display: none;">
                                                    <textarea placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..." required></textarea>
                                                    <button class="btn-submit-reply" data-post-id="{{ post.id }}" data-parent-id="{{ reply.id }}">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        {% empty %}
                            <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
                        {% endfor %}
                    </div>
                    <div class="add-comment">
                        <textarea name="content" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                        <button class="btn-submit-comment" data-post-id="{{ post.id }}">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
  
    </div>
</div>
{% endblock %}
