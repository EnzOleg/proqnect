{% extends 'base.html' %}
{% load static %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
    <link rel="stylesheet" href="{% static 'css/comments.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/like.js' %}"></script>
<script src="{% static 'js/comments.js' %}"></script>
<script src="{% static 'js/profile.js' %}"></script>
{% endblock %}

{% block title %}{{ user.first_name }} {{ user.last_name }}{% endblock %}

{% block main_content %}
<div class="profile-container">
    <div class="profile-header" style="background-image: url('{% if user.cover_photo %}{{ user.cover_photo.url }}{% else %}{% static 'images/default_cover.png' %}{% endif %}');">
        <div class="profile-info">
            <div class="avatar">
                <img src="{{ user.profile_picture.url }}" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞" class="profile-avatar">
            </div>
            <div class="profile-name-status">
                <h1>{{ user.first_name }} {{ user.last_name }}</h1>
                <p class="status">{{ user.status|default_if_none:'' }}</p>
                {% if request.user == user %}
                    <a href="{% url 'accounts:settings' %}" class="btn-edit-profile">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                {% else %}
                    <a href="{% url 'chat:chat_with_user' user.id %}" class="btn-message">–ù–∞–ø–∏—Å–∞—Ç—å</a>
                    {% if not is_friend %}
                        <form method="post" action="{% url 'friends:add_friend' user.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn-add-friend">–î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑—å—è</button>
                        </form>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="profile-menu">
        <a href="#profile-feed">–ü—É–±–ª–∏–∫–∞—Ü–∏–∏</a>
        <a href="#friends">–î—Ä—É–∑—å—è</a>
        <a href="{% url 'chat:chat_home' %}">–°–æ–æ–±—â–µ–Ω–∏—è</a>
    </div>

    <div class="profile-content">
        <div class="profile-sidebar">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <p>{{ user.bio|default_if_none:'–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏' }}</p>
            <br>
            <p>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {{ user.date_joined|date:"d M Y" }}</p>
            <h2>–î—Ä—É–∑—å—è</h2>
            <ul>
                {% for friend in friends %}
                    <li>
                        <img src="{{ friend.profile_picture.url }}" alt="–ê–≤–∞—Ç–∞—Ä">
                        <p>{{ friend.first_name }} {{ friend.last_name }}</p>
                        <a href="{% url 'accounts:profile' friend.id %}">–ü–µ—Ä–µ–π—Ç–∏</a>
                    </li>
                {% empty %}
                    <p>–ù–µ—Ç –¥—Ä—É–∑–µ–π.</p>
                {% endfor %}
            </ul>
        </div>

        <div class="profile-feed" id="profile-feed">
            <div class="new-post">
                <form action="{% url 'accounts:add_post' %}" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="new-post-header">
                        <img src="{{ request.user.profile_picture.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="new-post-avatar">
                        <textarea name="content" placeholder="–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?" required></textarea>
                    </div>
                    
                    <div class="new-post-actions">
                        <label for="postFile" class="file-label">
                            <img src="{% static 'images/clip.png' %}" alt="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª" class="file-icon">
                            <span>–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª</span>
                            <input type="file" id="postFile" name="image" accept="image/*,video/*,audio/*" onchange="updateFileName(this)">
                        </label>
                        
                        <button type="submit">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                    </div>
                </form>
            </div>
            
            {% for post in posts %}
            <div class="post">
                <div class="post-header">
                    <img src="{{ post.user.profile_picture.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="post-avatar">
                    <div>
                        <p>{{ post.user.first_name }} {{ post.user.last_name }}</p>
                        <span class="post-date">{{ post.created_at|date:"d M Y H:i" }}</span>
                    </div>
                </div>
                <p>{{ post.content }}</p>
                {% if post.image %}
                    <img src="{{ post.image.url }}" class="post-image" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                {% endif %}
                <div class="post-actions">
                    <button class="like-btn" data-post-id="{{ post.id }}">
                        {% if post.is_liked %}
                            ‚ù§Ô∏è {{ post.likes.count }}
                        {% else %}
                            ü§ç {{ post.likes.count }}
                        {% endif %}
                    </button>                                   
                </div>
                {% include 'partials/post_comments.html' with post=post %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}